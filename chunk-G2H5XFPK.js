import{a as J,b as L,c as G,d as Q,e as q,f as z,g as X}from"./chunk-UMGCYNAL.js";import{g as $,h as U,i as j}from"./chunk-ZTVWNM4H.js";import{Ha as k,Ia as d,Ma as l,Na as c,Oa as b,Pa as E,Q as v,Qa as f,Ra as S,Sa as y,Ta as W,Ua as O,V as P,Va as M,Wa as I,Xa as D,Ya as R,Z as N,Za as F,_a as V,c as s,d as H,ga as K,ha as T,wa as p,xa as B}from"./chunk-GEQ6AVHT.js";function Y(o){try{return JSON.parse(o),!0}catch{return!1}}var Z="Vaults",x=(()=>{let a=class a{constructor(){this.init()}init(e=!1){return s(this,null,function*(){let i=localStorage.getItem("Vaults"),t;if(i)t=JSON.parse(i);else{let{hmacKey:r,aesKey:n}=yield this.genereateSecretKey(),{publicKey:h,privateKey:w}=yield this.generateKeyPair();yield this.importKeyPair({privateKey:w,publicKey:h});let g=yield this.encryptDataWithRSA(n),m=yield this.encryptDataWithRSA(r);t={sec:g,mac:m,kid:h,kcs:w},localStorage.setItem(Z,JSON.stringify(t))}if(e){localStorage.removeItem(Z),yield this.init(!1);return}if(!this.publicKey&&!this.privateKey&&(yield this.importKeyPair({privateKey:t?.kcs,publicKey:t?.kid})),!this.aesKey){let r=yield this.decryptDataWithRSA(t?.sec);yield this.importAESKey(r)}if(!this.hmacKey){let r=yield this.decryptDataWithRSA(t?.mac);yield this.importHMACKey(r)}})}generateAESKey(){return s(this,null,function*(){return yield window.crypto.subtle.generateKey({name:"AES-CBC",length:256},!0,["encrypt","decrypt"])})}createRSAKeyPair(){return s(this,null,function*(){return yield window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["encrypt","decrypt"])})}generateKeyPair(){return s(this,null,function*(){let e=yield this.createRSAKeyPair(),i=yield window.crypto.subtle.exportKey("pkcs8",e.privateKey),t=yield window.crypto.subtle.exportKey("spki",e.publicKey);return{privateKey:this.arrayBufferToBase64(i),publicKey:this.arrayBufferToBase64(t)}})}importKeyPair(e){return s(this,null,function*(){this.publicKey=yield window.crypto.subtle.importKey("spki",this.base64ToArrayBuffer(e.publicKey),{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),this.privateKey=yield window.crypto.subtle.importKey("pkcs8",this.base64ToArrayBuffer(e.privateKey),{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"])})}encryptDataWithAES(e,i=!1,t){return s(this,null,function*(){let r=t||this.aesKey,n=window.crypto.getRandomValues(new Uint8Array(16)),h=typeof e=="string"?e:JSON.stringify(e),w=this.toBuffer(h),g=yield window.crypto.subtle.encrypt({name:"AES-CBC",iv:n},r,w),m=this.arrayBufferToHexString(n),C=this.arrayBufferToHexString(g),A=i?yield this.generateHMAC(C):null,_=m+(i?A+this.hexToBase64(C):this.hexToBase64(C));return{signature:A,result:_}})}decryptDataWithAES(e,i=!1,t,r){return s(this,null,function*(){let n=r||this.aesKey,h=t||e.slice(0,32),w=i?e.slice(32,96):null,g=i?e.slice(96):e.slice(32),m=this.base64ToArrayBuffer(g);if(!(i?yield this.verifyHMAC(this.arrayBufferToHexString(m),w):!0))throw new Error("Data integrity check failed");let A=yield window.crypto.subtle.decrypt({name:"AES-CBC",iv:this.hexStringToArrayBuffer(h)},n,m),_=this.fromBuffer(A);return Y(_)?JSON.parse(_):_})}encryptDataWithRSA(e,i){return s(this,null,function*(){let t=i||this.publicKey,r=this.toBuffer(e),n=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},t,r);return this.arrayBufferToHexString(n)})}decryptDataWithRSA(e,i){return s(this,null,function*(){let t=i||this.privateKey,r=yield window.crypto.subtle.decrypt({name:"RSA-OAEP"},t,this.hexStringToArrayBuffer(e));return this.fromBuffer(r)})}genereateSecretKey(){return s(this,null,function*(){let e=yield this.generateAESKey(),i=yield window.crypto.subtle.exportKey("raw",e),t=yield window.crypto.subtle.digest("SHA-256",i),r=this.arrayBufferToHexString(t);console.log("hashedKey",r);let n=r.slice(r.length/2,r.length);return{aesKey:n.concat(r.slice(0,r.length/2)),hmacKey:n}})}hash(e){return s(this,null,function*(){let i=this.toBuffer(e),t=yield window.crypto.subtle.digest("SHA-256",i);return this.arrayBufferToHexString(t)})}importAESKey(e){return s(this,null,function*(){this.aesKey=yield window.crypto.subtle.importKey("raw",this.hexStringToArrayBuffer(e),"AES-CBC",!0,["encrypt","decrypt"])})}generateHMAC(e,i){return s(this,null,function*(){let t=i||this.hmacKey,r=this.toBuffer(e),n=yield window.crypto.subtle.sign("HMAC",t,r);return this.arrayBufferToHexString(n)})}verifyHMAC(e,i,t){return s(this,null,function*(){let r=t||this.hmacKey,n=this.toBuffer(e),h=this.hexStringToArrayBuffer(i);return yield window.crypto.subtle.verify("HMAC",r,h,n)})}importHMACKey(e){return s(this,null,function*(){this.hmacKey=yield window.crypto.subtle.importKey("raw",this.hexStringToArrayBuffer(e),{name:"HMAC",hash:{name:"SHA-256"}},!0,["sign","verify"])})}generateSessionId(){let e=window.crypto.getRandomValues(new Uint32Array(8)),i=Array.from(e,r=>("0"+r.toString(16)).slice(-2)).join(""),t=Date.now().toString(16);return`${i}${t}`}arrayBufferToBase64(e){let t=new Uint8Array(e).reduce((r,n)=>r+String.fromCharCode(n),"");return window.btoa(t)}base64ToArrayBuffer(e){let i=window.atob(e),t=i.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=i.charCodeAt(n);return r.buffer}hexToBase64(e){let i=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)i[r/2]=parseInt(e.slice(r,r+2),16);let t=i.reduce((r,n)=>r+String.fromCharCode(n),"");return window.btoa(t)}arrayBufferToHexString(e){return new Uint8Array(e).reduce((t,r)=>t+r.toString(16).padStart(2,"0"),"")}hexStringToArrayBuffer(e){let i=new Uint8Array(e.length/2);for(let t=0;t<e.length;t+=2)i[t/2]=parseInt(e.slice(t,t+2),16);return i.buffer}toBuffer(e){return new TextEncoder().encode(e)}fromBuffer(e){return new TextDecoder().decode(e)}};a.\u0275fac=function(i){return new(i||a)},a.\u0275prov=v({token:a,factory:a.\u0275fac,providedIn:"root"});let o=a;return o})();var ie=(()=>{let a=class a{constructor(e){this.crypto=e}setCookie(e,i,t=0,r="/",n=!0,h="Strict"){return s(this,null,function*(){let w=typeof i=="object"?JSON.stringify(i):i,g="";if(n?(w=(yield this.crypto.encryptDataWithAES(w)).result,g+=`${e}=${w};path=${r};Secure`):g+=`${e}=${w};path=${r}`,t){let m=new Date;m.setTime(m.getTime()+t*24*60*60*1e3),g+=`;expires=${m.toUTCString()}`}h&&(g+=`;SameSite=${h}`),document.cookie=g})}getCookie(e,i=!0){return s(this,null,function*(){let t=`${e}=`,r=document.cookie.split(";");try{for(var n=H(r),h,w,g;h=!(w=yield n.next()).done;h=!1){let m=w.value;if(m=m.trim(),m.startsWith(t)){let C=m.substring(t.length);return i?yield this.crypto.decryptDataWithAES(C):C}}}catch{g=[w]}finally{try{h&&(w=n.return)&&(yield w.call(n))}finally{if(g)throw g[0]}}return null})}deleteCookie(e,i="/"){document.cookie=`${e}=; Max-Age=0; path=${i}`}getAllKeys(){let e=document.cookie.split(";"),i=[];for(let t of e)if(t=t.trim(),t){let[r]=t.split("=");i.push(r)}return i}clearAll(){let e=this.getAllKeys();for(let i of e)this.deleteCookie(i)}};a.\u0275fac=function(i){return new(i||a)(P(x))},a.\u0275prov=v({token:a,factory:a.\u0275fac,providedIn:"root"});let o=a;return o})();var re=()=>({standalone:!0});function oe(o,a){if(o&1&&(l(0,"div")(1,"label",14),y(2,"AES Key:"),c(),b(3,"br")(4,"small",15)(5,"hr"),c()),o&2){let u=S();p(4),d("innerText",u.aesKey)}}function ae(o,a){if(o&1&&(l(0,"div")(1,"label",14),y(2,"Signature:"),c(),b(3,"br")(4,"small",15)(5,"hr"),c()),o&2){let u=S();p(4),d("innerText",u.signature)}}function se(o,a){if(o&1&&(l(0,"div",16),b(1,"hr")(2,"small",15),c()),o&2){let u=S();p(2),d("innerText",u.cipherText)}}function ce(o,a){if(o&1&&(l(0,"div",17)(1,"p"),y(2,"Decoded Text:"),c(),b(3,"small",15),c()),o&2){let u=S();p(3),d("innerText",u.decodedText)}}function le(o,a){if(o&1){let u=E();l(0,"button",8),f("click",function(){K(u);let i=S();return T(i.decrypt())}),y(1,"Decrypt"),c()}}function pe(o,a){if(o&1){let u=E();l(0,"button",8),f("click",function(){K(u);let i=S();return T(i.verify())}),y(1,"Verify Signature"),c()}}function ye(o,a){if(o&1){let u=E();l(0,"button",8),f("click",function(){K(u);let i=S();return T(i.sharedKey())}),y(1,"Shared Key"),c()}}function ue(o,a){if(o&1&&(l(0,"p"),y(1),c()),o&2){let u=S();p(),O("Retrieved Cookie: ",u.retrievedCookie,"")}}function de(o,a){if(o&1&&(l(0,"li"),y(1),c()),o&2){let u=a.$implicit;p(),W(u)}}var xe=(()=>{let a=class a{constructor(e,i){this.crypto=e,this.cookieService=i,this.cookieName="",this.cookieValue="",this.retrievedCookie=null,this.allCookies=[]}ngOnInit(){return s(this,null,function*(){})}onChange(e,i){e==="plain"?this.plainText=i.target.value:this.cipherText=i.target.value}encrypt(){return s(this,null,function*(){let e=yield this.crypto.hash(this.plainText),i=yield this.crypto.generateHMAC(this.plainText),t=yield this.crypto.encryptDataWithAES(this.plainText),r=yield this.crypto.decryptDataWithAES(t.result),n=this.crypto.generateSessionId();this.cipherText=(yield this.crypto.encryptDataWithAES(this.plainText)).result,this.signature=i,console.table({sessionId:n,hashed:e,signature:i,encrypted:t,decrypted:r})})}decrypt(){return s(this,null,function*(){this.decodedText=yield this.crypto.decryptDataWithAES(this.cipherText)})}verify(){return s(this,null,function*(){return(yield this.crypto.verifyHMAC(this.plainText,this.signature))?alert("Signature valid"):alert(`Signature ${this.signature} invalid, data has been changed!`)})}sharedKey(){return s(this,null,function*(){})}generateKeyPair(){return s(this,null,function*(){let e=yield this.crypto.genereateSecretKey();yield this.crypto.importAESKey(e.aesKey),yield this.crypto.importHMACKey(e.hmacKey),this.aesKey=e.aesKey,console.table(e)})}setCookie(){this.cookieService.setCookie(this.cookieName,this.cookieValue)}getCookie(){return s(this,null,function*(){this.retrievedCookie=yield this.cookieService.getCookie(this.cookieName)})}deleteCookie(){this.cookieService.deleteCookie(this.cookieName),this.retrievedCookie=null}listAllCookies(){this.allCookies=this.cookieService.getAllKeys()}clearAllCookies(){this.cookieService.clearAll(),this.allCookies=[],this.retrievedCookie=null}};a.\u0275fac=function(i){return new(i||a)(B(x),B(ie))},a.\u0275cmp=N({type:a,selectors:[["app-security"]],standalone:!0,features:[R([x]),F],decls:37,vars:15,consts:[[1,"container"],[1,"form","form-auto"],[4,"ngIf"],["for","PlainText"],["id","PlainText","rows","4","cols","62",3,"blur"],["style","max-width: 480px; min-height: 20px; text-wrap: wrap; overflow: scroll; word-wrap: break-word;",4,"ngIf"],["id","PlainText","style","max-width: 360px; min-height: 20px; text-wrap: wrap; overflow: scroll; word-wrap: break-word;",4,"ngIf"],[1,"btn-group"],["type","button",3,"click"],["type","button",3,"click",4,"ngIf"],["placeholder","Cookie Name",3,"ngModelChange","ngModel","ngModelOptions"],["placeholder","Cookie Value",3,"ngModelChange","ngModel","ngModelOptions"],[3,"click"],[4,"ngFor","ngForOf"],["for","Signature"],[3,"innerText"],[2,"max-width","480px","min-height","20px","text-wrap","wrap","overflow","scroll","word-wrap","break-word"],["id","PlainText",2,"max-width","360px","min-height","20px","text-wrap","wrap","overflow","scroll","word-wrap","break-word"]],template:function(i,t){i&1&&(l(0,"div",0)(1,"form",1),k(2,oe,6,1,"div",2)(3,ae,6,1,"div",2),l(4,"label",3),y(5,"Plain Data:"),c(),b(6,"br"),l(7,"textarea",4),f("blur",function(n){return t.onChange("plain",n)}),c(),k(8,se,3,1,"div",5)(9,ce,4,1,"div",6),l(10,"div",7)(11,"button",8),f("click",function(){return t.encrypt()}),y(12,"Encrypt"),c(),k(13,le,2,0,"button",9),l(14,"button",8),f("click",function(){return t.generateKeyPair()}),y(15,"Generate Key Pair"),c(),k(16,pe,2,0,"button",9)(17,ye,2,0,"button",9),c(),b(18,"hr"),l(19,"div")(20,"h3"),y(21,"Cookie Management"),c(),l(22,"input",10),D("ngModelChange",function(n){return I(t.cookieName,n)||(t.cookieName=n),n}),c(),l(23,"input",11),D("ngModelChange",function(n){return I(t.cookieValue,n)||(t.cookieValue=n),n}),c(),l(24,"button",12),f("click",function(){return t.setCookie()}),y(25,"Set Cookie"),c(),l(26,"button",12),f("click",function(){return t.getCookie()}),y(27,"Get Cookie"),c(),l(28,"button",12),f("click",function(){return t.deleteCookie()}),y(29,"Delete Cookie"),c(),l(30,"button",12),f("click",function(){return t.listAllCookies()}),y(31,"List All Cookies"),c(),l(32,"button",12),f("click",function(){return t.clearAllCookies()}),y(33,"Clear All Cookies"),c(),k(34,ue,2,1,"p",2),l(35,"ul"),k(36,de,2,1,"li",13),c()()()()),i&2&&(p(2),d("ngIf",t.aesKey),p(),d("ngIf",t.signature),p(5),d("ngIf",t.cipherText),p(),d("ngIf",t.decodedText),p(4),d("ngIf",t.cipherText),p(3),d("ngIf",t.signature),p(),d("ngIf",t.aesKey),p(5),M("ngModel",t.cookieName),d("ngModelOptions",V(13,re)),p(),M("ngModel",t.cookieValue),d("ngModelOptions",V(14,re)),p(11),d("ngIf",t.retrievedCookie),p(2),d("ngForOf",t.allCookies))},dependencies:[j,$,U,X,z,J,L,G,q,Q]});let o=a;return o})();export{xe as SecurityComponent};
